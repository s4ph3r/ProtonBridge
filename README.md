<h1 align="center">Описание проекта</h1>

В далеком 2020 году в голову пришла идея купить за 1.5$ модуль BT4.0 AT-09 (с SOC CC2541 - на аналогичном камне сделан BT кусок AtomFast/Swift) и запилить из него мост UART - приложение AtomSwift, т.е. купив отладчик CC Debugger разработать собственную прошивку для него, описав BT профиль Atom. 
Корневая ветка форума - http://forum.rhbz.org/topic.php?forum=80&topic=98

В интернете гуляет инфа как при помощи обычной Arduino выполнить прошивку данного модуля без отладчика CC Debugger, поэтому данный проект может стать вполне народным, т.к. 1.5$ за такой модуль может себе позволить я думаю любой участник форума строящий самодельный дозиметр, или решивший модифицировать ДП-5 данным модулем + Arduino или другой МК, или прикрутив к самодельному спектрометру, сделав из него шустрый дозиметр с возможностью построения трека на карте в реальном времени при обследовании местности.

Для быстрой отладки был на скорою руку набросан софт под винду для генерирования рандомных, но приближенных к реальности данных и отправки их через преобразователь USB-UART в данный BT модуль.
На данный момент описана основная часть профиля Atom для вывода в приложение дозы, мощности дозы и прочих параметров описанных в основной измерительной характеристике, срисована схема модуля, что бы понимать что куда подключать, скриншоты реальной работы модуля см. ниже. ВПО модуля работает в прозрачном режиме - т.е. что пользователь отправил по UART , модуль эти данные передаст в нужном формате по BT в приложение.
Ну и если забыли приложение AtomSwift позволяет выводить трек на карты с привязкой по GPS/ГЛОНАСС.

Модуль на данный момент работает только в активном режиме (без сна) и жрет порядка 8мА.

По-сути осталось допилить правильный уход в сон, с выключением uart и правильное пробуждение с включением uart.

Для сборки использовать Embedded Workbench for 8051 version 10.30.

ЗЫ: для тех кто посчитает этот проект нелегальным - Madmax дал добро на сие использование его приложения.



<h1 align="center">Порядок прошивки модуля AT-09 с использованием Arduino</h1>

1. Скачать из любого источника и установить Arduino IDE (я использовал портативную 1.8.11, скачанную https://amperka.ru/page/arduino-ide)
2. Скачать Arduino CCLoader https://github.com/RedBearLab/CCLoader
3. Залить в Arduino скетч CCLoader/CCLoader.ino
4. Скачать "srecord-1.63-win32" из "Tools" или отсюда - http://srecord.sourceforge.net/download.html
5. Копируем из папки "BLE-CC254x-1.5.1.1\Projects\ble\ProtonBridge\CC2541DB\CC2541\Exe" файл "ProtonBridgel.hex" в папку "srecord-1.63-win32"
6. Используя SRecord из папки Tools запускаем "convert hex to bin.bat" (или командой "srec_cat ProtonBridge.hex -Intel -o ProtonBridge.bin -Binary")
7. Открываем файл ProtonBridge.bin любым HEX редактором и добиваем "FF" конец файла до адреса "3FFFF" (примерно 138126 пустых байт, до итогового размера в 256кБ)
8. Соединить Arduino c модулем следующим образом:
- 4 порт Arduino к RESET_N модуля;
- 5 порт Arduino к P2.2 (DebugData) модуля;
- 6 порт Arduino к P2.1 (DebugClock) модуля;
- подключить землю GND и питание +3.3V в случае если модуль без переходной платы, или +5V если модуль с переходной печатной платой.
5. Открыть окно коммандной строки в окне с CCLoader.exe (правой кнопкой мыши с зажатым шифтом) и запустить прошивку следующей командой:
CCLoader.exe 9 ProtonBridge.bin 0
(9 это СОМ9, 0 это устройство по умолчанию - UNO)
Если висит на надписи Waiting for respond from Arduino - проверить правильность подключения, нажать ctrl+c и еще раз дать команду, софт бывает тупит даже при правильном подключении.
6. Модуль успешно прошит.

USB-UART адаптер для проверки функционала модуля нужно использовать с уровнем единицы не более 3.6В! Либо делать схему согласования уровней, схем в сети куча. Я использовал свой универсальный сдвоенный преобразователь на FT2232.

